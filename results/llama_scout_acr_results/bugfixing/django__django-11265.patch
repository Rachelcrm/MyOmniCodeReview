{
  "patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex d69c24419b..57bd8b0387 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1665,7 +1665,7 @@ class Query(BaseExpression):\n         if isinstance(filter_rhs, F):\n             filter_expr = (filter_lhs, OuterRef(filter_rhs.name))\n         # Generate the inner query.\n-        query = Query(self.model)\n+        query = Query(self.model, alias_cols=self.alias_cols)\n         query.add_filter(filter_expr)\n         query.clear_ordering(True)\n         # Try to have as simple as possible subquery -> trim leading joins from\n@@ -1679,6 +1679,8 @@ class Query(BaseExpression):\n         col = query.select[0]\n         select_field = col.target\n         alias = col.alias\n+        if alias is None:\n+            alias = query.get_initial_alias()\n         if self.is_nullable(select_field):\n             lookup_class = select_field.get_lookup('isnull')\n             lookup = lookup_class(select_field.get_col(alias), False)\n"
}